"use strict";function _classCallCheck(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_createClass=function(){function e(e,n){for(var t=0;t<n.length;t++){var o=n[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(n,t,o){return t&&e(n.prototype,t),o&&e(n,o),n}}();document.addEventListener("DOMContentLoaded",function(){new View,new ViewOrganizations,new ViewCampaigns,new ViewNavigation,new ViewWorksheets,new ViewSpotTypes,new ViewRegions,new ViewInvoices},!1);var CampaignsController=function(){function e(){_classCallCheck(this,e),this.AjaxHelpers=new AjaxHelpers}return _createClass(e,[{key:"loadRegionsFromOrganization",value:function(e){var n="/api/v1/regions/"+e;return this.AjaxHelpers.getCall(n)}},{key:"loadCampaignsFromRegion",value:function(e){var n="/api/v1/campaigns/"+e;return this.AjaxHelpers.getCall(n)}},{key:"createNewCampaign",value:function(e){var n="/api/v1/campaigns/new";return this.AjaxHelpers.postCall(n,e)}},{key:"calculateFlightLengthInWeeks",value:function(e,n){var t=moment(e,"YYYY-MM-DD"),o=moment(n,"YYYY-MM-DD"),i=moment.duration(o.diff(t)),r=i.asWeeks().toFixed(0);return r<0||0==r?"Invalid Dates":r}}]),e}(),WorksheetsController=function(){function e(){_classCallCheck(this,e),this.AjaxHelpers=new AjaxHelpers}return _createClass(e,[{key:"persistWorksheetWeekInformation",value:function(e){var n=document.querySelector(".worksheet-counts-"+e),t=this.AjaxHelpers.serialize(n),o="/api/v1/worksheet/"+e+"/update";return""!=t&&this.AjaxHelpers.postCall(o,t)}}]),e}(),ActionHelpers=function(){function e(){_classCallCheck(this,e),this.confirmAction()}return _createClass(e,[{key:"confirmAction",value:function(e,n){var t=document.querySelectorAll(e);t&&t.forEach(function(e){e.onclick=function(t){t.preventDefault();var o=e.href,i=confirm(n);i&&(window.location=o)}})}},{key:"fieldTypeCheck",value:function(e){var n=!1;return e.name&&!e.disabled&&"file"!=e.type&&"reset"!=e.type&&"submit"!=e.type&&"button"!=e.type&&(n=!0),n}}]),e}(),AjaxHelpers=function(){function e(){_classCallCheck(this,e),this.ActionHelpers=new ActionHelpers}return _createClass(e,[{key:"getCall",value:function(e){return new Promise(function(n,t){var o=new XMLHttpRequest;o.open("GET",e),o.onload=function(){200===o.status?n(JSON.parse(o.response)):t(new Error(o.statusText))},o.onerror=function(){t(new Error("Network Error"))},o.send()})}},{key:"postCall",value:function(e,n){return new Promise(function(t,o){var i=new XMLHttpRequest;i.open("POST",e,!0),i.setRequestHeader("Content-type","application/x-www-form-urlencoded"),i.onload=function(){200===i.status?t(JSON.parse(i.response)):o(new Error(i.statusText))},i.onerror=function(){o(new Error("Network Error"))},i.send(n)})}},{key:"serialize",value:function(e){var n=[],t=[];if("object"==("undefined"==typeof e?"undefined":_typeof(e))&&"FORM"==e.nodeName)for(var o=e.elements.length,i=0;i<o;i++){n=e.elements[i];var r=this.ActionHelpers.fieldTypeCheck(n);if(r)if("select-multiple"==n.type)for(var a=e.elements[i].options.length-1,l=a;l>=0;l--)n.options[l].selected&&(t[t.length]=encodeURIComponent(n.name)+"="+encodeURIComponent(n.options[l].value));else("checkbox"!=n.type&&"radio"!=n.type||n.checked)&&(t[t.length]=encodeURIComponent(n.name)+"="+encodeURIComponent(n.value))}return t.join("&").replace(/%20/g,"+")}}]),e}(),View=function(){function e(){_classCallCheck(this,e),this.ActionHelpers=new ActionHelpers,this.registerDeleteConfirmation()}return _createClass(e,[{key:"registerDeleteConfirmation",value:function(){this.ActionHelpers.confirmAction("a.delete-button","Do you really want to delete this?")}}]),e}(),ViewCampaigns=function(){function e(){_classCallCheck(this,e),this.CampaignsController=new CampaignsController,this.CampOverlay=document.querySelector(".campaigns-overlay"),this.loadRegionsFromOrganizationForCampaign(),this.loadRegionsForCampaignEdit(),this.setFlightFieldFormats(),this.setFlightWeeks(),this.CampOverlay&&this.createCampaignFromDashboard()}return _createClass(e,[{key:"loadRegionsFromOrganizationForCampaign",value:function(){var e=this,n=document.querySelector("#campaign-organization"),t=document.querySelector("#campaign-region");n&&(n.onchange=function(){var n=this.value;t.innerHTML='<option value="">Select Organization</option>',""!==n&&(t.innerHTML="",e.CampaignsController.loadRegionsFromOrganization(n).then(function(e){t.innerHTML=t.innerHTML+'<option value="">Select A Region</option>',e.forEach(function(e){t.innerHTML=t.innerHTML+'<option value="'+e.id+'">'+e.name+"</option>"})}))})}},{key:"setFlightFieldFormats",value:function(){var e=document.querySelector(".flight-start"),n=document.querySelector(".flight-end");e&&new Formatter(e,{pattern:"{{9999}}-{{99}}-{{99}}",persist:!0}),n&&new Formatter(n,{pattern:"{{9999}}-{{99}}-{{99}}",persist:!0})}},{key:"setFlightWeeks",value:function(){var e=this,n=document.querySelector("#flight-start"),t=document.querySelector("#flight-end"),o=document.querySelector("#flight-length");n&&(n.onkeyup=function(){var i=n.value,r=t.value;i.length>9&&r.length>9&&(o.value=e.CampaignsController.calculateFlightLengthInWeeks(i,r)+" Weeks")}),t&&(t.onkeyup=function(){var i=n.value,r=t.value;i.length>9&&r.length>9&&(o.value=e.CampaignsController.calculateFlightLengthInWeeks(i,r)+" Weeks")})}},{key:"createCampaignFromDashboard",value:function(){var e=this,n=document.querySelector(".campaigns-overlay"),t=document.querySelector(".dash-create-campaign-button"),o=n.querySelector(".close"),i=n.querySelector("form");t.onclick=function(){n.style.display="block"},o.onclick=function(){n.style.display="none"},i.onsubmit=function(n){n.preventDefault();var t=e.AjaxHelpers.serialize(i);e.CampaignsController.createNewCampaign(t).then(function(e){var n=i.classList;1==e.success?(i.reset(),n.add("successful"),setTimeout(function(){n.remove("successful")},1e3)):(n.add("failure"),setTimeout(function(){n.remove("failure")},1e3))})}}},{key:"loadRegionsForCampaignEdit",value:function(){var e=this,n=document.querySelector(".campaign-edit");if(null!==n){var t=document.querySelector("#campaign-organization"),o=document.querySelector("#campaign-region"),i=t.value;o.innerHTML='<option value="">Select Organization</option>',""!==i&&(o.innerHTML=o.innerHTML+'<option value="">Select Region</option>',e.CampaignsController.loadRegionsFromOrganization(i).then(function(e){e.forEach(function(e){i==e.id?o.innerHTML=o.innerHTML+'<option value="'+e.id+'" selected="selected">'+e.name+"</option>":o.innerHTML=o.innerHTML+'<option value="'+e.id+'">'+e.name+"</option>"})}))}}}]),e}(),ViewInvoices=function(){function e(){_classCallCheck(this,e),this.setRegionForInvoiceImporter(),this.setInvoiceCampaigns(),this.CampaignsController=new CampaignsController}return _createClass(e,[{key:"setRegionForInvoiceImporter",value:function(){var e=this,n=document.querySelector("#organizations"),t=document.querySelector("#regions");n&&(n.onchange=function(){var n=this.value;t.innerHTML='<option value="">Select Organization</option>',""!==n&&e.CampaignsController.loadRegionsFromOrganization(n).then(function(e){t.innerHTML='<option value="">Select Region</option>',e.forEach(function(e){t.innerHTML=t.innerHTML+'<option value="'+e.id+'">'+e.name+"</option>"}),0==e.length&&(t.innerHTML=t.innerHTML+'<option value="">No Available Regions</option>')})})}},{key:"setInvoiceCampaigns",value:function(){var e=this,n=document.querySelector("#regions"),t=document.querySelector("#campaigns");n&&(n.onchange=function(){var n=this.value;t.innerHTML='<option value="">Select Region</option>',""!==n&&e.CampaignsController.loadCampaignsFromRegion(n).then(function(e){t.innerHTML='<option value="">Select Campaign</option>',e.forEach(function(e){t.innerHTML=t.innerHTML+'<option value="'+e.id+'">'+e.name+"</option>"}),0==e.length&&(t.innerHTML=t.innerHTML+'<option value="">No Available Campaigns</option>')})})}}]),e}(),ViewNavigation=function(){function e(){_classCallCheck(this,e),this.navigationToggle()}return _createClass(e,[{key:"navigationToggle",value:function(){var e=document.querySelector(".hamburger");e.onclick=function(){var e=document.querySelector(".masthead"),n=e.classList;n.toggle("show")}}}]),e}(),ViewOrganizations=function(){function e(){_classCallCheck(this,e),this.AjaxHelpers=new AjaxHelpers,this.OrgList=document.querySelectorAll(".organization-list li label"),this.OrgOverlay=document.querySelector(".organizations-overlay"),this.OrgList&&this.loadRegionsFromOrganizationForDashboard(),this.OrgOverlay&&this.createOrganizationFromDashboard()}return _createClass(e,[{key:"loadRegionsFromOrganizationForDashboard",value:function(){var e=this,n=document.querySelectorAll(".organization-list li label"),t=document.querySelector(".region-information");n.forEach(function(n){n.onclick=function(){var o=n.dataset.id,i=this.dataset.name,r="/api/v1/regions/"+o;e.AjaxHelpers.getCall(r).then(function(n){t.innerHTML='<h1 class="content-title">'+i+" Regions</h1>",t.innerHTML=t.innerHTML+'<ul class="region-list"></ul>',n.length>0?n.forEach(function(e){var n=t.querySelector(".region-list");n.innerHTML=n.innerHTML+'<li class="region-selector region-selector-'+e.id+'" data-id="'+e.id+'">'+e.name+"</li>"}):t.innerHTML=t.innerHTML+'<p class="align-center">There Are No Regions</p>',t.innerHTML=t.innerHTML+'<div class="region-campaigns"></div>',e.loadCampaignsFromRegion()})}})}},{key:"loadCampaignsFromRegion",value:function(){var e=this,n=document.querySelectorAll(".region-selector");n.forEach(function(n){n.onclick=function(){var t=n.dataset.id,o="/api/v1/campaigns/"+t,i=document.querySelector(".region-campaigns"),r=n.innerHTML;e.AjaxHelpers.getCall(o).then(function(e){i.innerHTML='<p class="align-center">There Are No Campaigns For This Region</p>',e.length>0&&(i.innerHTML='<h1 class="campaigns-title">'+r+" Campaigns</h1>",i.innerHTML=i.innerHTML+'<ul class="campaign-list"></ul>',e.forEach(function(e){var n=i.querySelector(".campaign-list");n.innerHTML=n.innerHTML+'<li class="campaign-selector campaign-selector-'+e.id+'" data-id="'+e.id+'">'+e.name+"</li>";var t=n.querySelector(".campaign-selector-"+e.id);t.innerHTML=t.innerHTML+'<div class="actions"><a href="/campaigns/worksheets/'+e.id+'">Worksheets</a><a href="/reports/station-order/'+e.id+'" target="_blank">Station Order</a></div>'}))})}})}},{key:"createOrganizationFromDashboard",value:function(){var e=this,n=document.querySelector(".organizations-overlay"),t=document.querySelector(".dash-create-organizations-button"),o=n.querySelector(".close"),i=n.querySelector("form"),r="/api/v1/organizations/new";t.onclick=function(){n.style.display="block"},o.onclick=function(){n.style.display="none"},i.onsubmit=function(n){n.preventDefault();var t=e.AjaxHelpers.serialize(i);e.AjaxHelpers.postCall(r,t).then(function(n){var t=i.classList;1==n.success?(i.reset(),t.add("successful"),e.refreshOrganizations(),setTimeout(function(){t.remove("successful")},1e3)):(t.add("failure"),setTimeout(function(){t.remove("failure")},1e3))})}}},{key:"refreshOrganizations",value:function(){var e=this,n=document.querySelector(".sidebar .organization-list"),t="/api/v1/organizations";e.AjaxHelpers.getCall(t).then(function(t){n.innerHTML="",t.forEach(function(e){n.innerHTML=n.innerHTML+'<li><label data-id="'+e.id+'" data-name="'+e.name+'">'+e.name+'<i class="fa fa-chevron-right"></i></label></li>'}),e.loadRegionsFromOrganizationForDashboard()})}}]),e}(),ViewRegions=function(){function e(){_classCallCheck(this,e),this.AjaxHelpers=new AjaxHelpers,this.RegionOverlay=document.querySelector(".regions-overlay"),this.RegionOverlay&&this.dashboardCreateRegion()}return _createClass(e,[{key:"dashboardCreateRegion",value:function(){var e=this,n=document.querySelector(".regions-overlay"),t=document.querySelector(".dash-create-regions-button"),o=n.querySelector(".close"),i=n.querySelector("form"),r="/api/v1/regions/new";t.onclick=function(){n.style.display="block"},o.onclick=function(){n.style.display="none"},i.onsubmit=function(n){n.preventDefault();var t=e.AjaxHelpers.serialize(i);e.AjaxHelpers.postCall(r,t).then(function(e){var n=i.classList;1==e.success?(i.reset(),n.add("successful"),setTimeout(function(){n.remove("successful")},1e3)):(n.add("failure"),setTimeout(function(){n.remove("failure")},1e3))})}}}]),e}(),ViewSpotTypes=function(){function e(){_classCallCheck(this,e),this.AjaxHelpers=new AjaxHelpers,this.SpotTypeOverlay=document.querySelector(".spot-types-overlay"),this.SpotTypeOverlay&&this.createSpotTypeFromDashboard()}return _createClass(e,[{key:"createSpotTypeFromDashboard",value:function(){var e=this,n=document.querySelector(".spot-types-overlay"),t=document.querySelector(".dash-create-spot-types-button"),o=n.querySelector(".close"),i=n.querySelector("form"),r="/api/v1/spot-types/new";t.onclick=function(){n.style.display="block"},o.onclick=function(){n.style.display="none"},i.onsubmit=function(n){n.preventDefault();var t=e.AjaxHelpers.serialize(i);e.AjaxHelpers.postCall(r,t).then(function(e){var n=i.classList;1==e.success?(i.reset(),n.add("successful"),setTimeout(function(){n.remove("successful")},1e3)):(n.add("failure"),setTimeout(function(){n.remove("failure")},1e3))})}}}]),e}(),ViewWorksheets=function(){function e(){_classCallCheck(this,e),this.Worksheets=new WorksheetsController,this.persistWeekInformationForWorksheet(),this.toggleProgramDetails(),this.setInnerOverflow(),document.querySelector(".info-inner")&&this.createTotalCalculations()}return _createClass(e,[{key:"persistWeekInformationForWorksheet",value:function(){var e=this,n=document.querySelectorAll(".update-week-information");n.forEach(function(n){n.onclick=function(t){t.preventDefault();var o=n.dataset.worksheet,i=n.parentNode.parentNode,r=i.classList,a=e.Worksheets.persistWorksheetWeekInformation(o);r.toggle("loading"),a.then(function(e){setTimeout(function(){r.toggle("loading"),1==e.success?(r.toggle("success"),setTimeout(function(){r.toggle("success")},700)):(r.toggle("failure"),setTimeout(function(){r.toggle("failure")},700))},100)})}})}},{key:"setInnerOverflow",value:function(){var e=document.querySelectorAll(".info-inner");e.forEach(function(e){var n=e.querySelectorAll(".spot-column"),t=n[0].offsetWidth,o=n.length;e.querySelector(".scrollable").style.width=t*o+"px"})}},{key:"createTotalCalculations",value:function(){var e=this,n=document.querySelectorAll(".info-inner");n.forEach(function(n){var t=n.querySelectorAll("input.date-count"),o=n.querySelectorAll(".spot-column");t.forEach(function(t){e.setWeeklyTotals(n,o,t.dataset.program),t.onkeyup=function(){e.setWeeklyTotals(n,o,this.dataset.program)}})})}},{key:"setWeeklyTotals",value:function(e,n,t){n.forEach(function(e){var n=e.querySelectorAll("input"),t=0;n.forEach(function(e){t=Number(e.value)+Number(t)}),e.querySelector(".week-total .total")&&(e.querySelector(".week-total .total").innerHTML=t)}),this.setWholeBuyTotals(e,t)}},{key:"setWholeBuyTotals",value:function(e,n){for(var t=e.querySelectorAll("input.date-count"),o=[],i=0,r=0;r<t.length;r++)t[r].dataset.program==n&&o.push(t[r]);for(var a=0;a<o.length;a++)i=Number(o[a].value)+Number(i);document.querySelector(".spot-date-total .program-"+n+"-total").innerHTML=i}},{key:"toggleProgramDetails",value:function(){var e=document.querySelectorAll(".extra-detail-expander");e.forEach(function(e){e.onclick=function(){var n=e.classList,t=e.parentNode.querySelector(".detail-wrapper"),o=t.style.display;n.toggle("rotated"),t.style.display="block"===o?"":"block"}})}}]),e}();